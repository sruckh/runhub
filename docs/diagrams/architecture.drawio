<mxGraphModel>
  <root>
    <mxCell id="0"/>
    <mxCell id="1" parent="0"/>

    <!-- Title -->
    <mxCell id="title" value="iMontage RunningHub â€” System Architecture" style="text;html=1;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
      <mxGeometry x="100" y="10" width="600" height="30" as="geometry"/>
    </mxCell>

    <!-- User -->
    <mxCell id="user" value="User (Browser)" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="350" y="50" width="100" height="50" as="geometry"/>
    </mxCell>

    <!-- Docker Container Group -->
    <mxCell id="docker" value="Docker Container (Node.js 20)" style="swimlane;startSize=28;fillColor=#fff2cc;strokeColor=#d6b656;rounded=1;fontSize=13;fontStyle=1;collapsible=0;" vertex="1" parent="1">
      <mxGeometry x="60" y="150" width="680" height="280" as="geometry"/>
    </mxCell>

    <!-- SvelteKit App Group -->
    <mxCell id="sveltekit" value="SvelteKit Application" style="swimlane;startSize=24;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;fontSize=12;fontStyle=1;collapsible=0;" vertex="1" parent="docker">
      <mxGeometry x="20" y="40" width="640" height="220" as="geometry"/>
    </mxCell>

    <!-- Frontend -->
    <mxCell id="frontend" value="&lt;b&gt;+page.svelte&lt;/b&gt;&lt;br&gt;Svelte 5 Frontend&lt;br&gt;&lt;i&gt;Form, Results Feed,&lt;br&gt;Fullscreen Modal&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="sveltekit">
      <mxGeometry x="20" y="35" width="150" height="80" as="geometry"/>
    </mxCell>

    <!-- Service Worker -->
    <mxCell id="sw" value="&lt;b&gt;Service Worker&lt;/b&gt;&lt;br&gt;&lt;i&gt;PWA Offline Cache&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="sveltekit">
      <mxGeometry x="20" y="135" width="150" height="50" as="geometry"/>
    </mxCell>

    <!-- API: /api/generate -->
    <mxCell id="api_generate" value="&lt;b&gt;/api/generate&lt;/b&gt;&lt;br&gt;&lt;i&gt;Scenario selection&lt;br&gt;Gemini prompt gen&lt;br&gt;RunningHub submit&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="sveltekit">
      <mxGeometry x="240" y="35" width="160" height="80" as="geometry"/>
    </mxCell>

    <!-- API: /api/check -->
    <mxCell id="api_check" value="&lt;b&gt;/api/check&lt;/b&gt;&lt;br&gt;&lt;i&gt;Task status polling&lt;br&gt;Image download&lt;br&gt;File save to /mount&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="sveltekit">
      <mxGeometry x="240" y="130" width="160" height="80" as="geometry"/>
    </mxCell>

    <!-- API: /api/images -->
    <mxCell id="api_images" value="&lt;b&gt;/api/images/[...path]&lt;/b&gt;&lt;br&gt;&lt;i&gt;Static image serving&lt;br&gt;Path traversal guard&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="sveltekit">
      <mxGeometry x="460" y="80" width="160" height="70" as="geometry"/>
    </mxCell>

    <!-- External: Google Gemini -->
    <mxCell id="gemini" value="&lt;b&gt;Google Gemini&lt;/b&gt;&lt;br&gt;Gemini 3 Pro&lt;br&gt;&lt;i&gt;Prompt Engineering&lt;/i&gt;" style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;fontStyle=0;" vertex="1" parent="1">
      <mxGeometry x="20" y="490" width="200" height="100" as="geometry"/>
    </mxCell>

    <!-- External: RunningHub -->
    <mxCell id="runninghub" value="&lt;b&gt;RunningHub API&lt;/b&gt;&lt;br&gt;FLUX.1-dev + LoRA&lt;br&gt;&lt;i&gt;Image Synthesis&lt;/i&gt;" style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;fontStyle=0;" vertex="1" parent="1">
      <mxGeometry x="300" y="490" width="200" height="100" as="geometry"/>
    </mxCell>

    <!-- Docker Volume -->
    <mxCell id="volume" value="&lt;b&gt;/mount&lt;/b&gt;&lt;br&gt;Docker Volume&lt;br&gt;&lt;i&gt;./outputs&lt;/i&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;size=10;" vertex="1" parent="1">
      <mxGeometry x="600" y="500" width="140" height="80" as="geometry"/>
    </mxCell>

    <!-- Reverse Proxy -->
    <mxCell id="proxy" value="&lt;b&gt;Reverse Proxy&lt;/b&gt;&lt;br&gt;&lt;i&gt;Nginx Proxy Manager&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;dashed=1;" vertex="1" parent="1">
      <mxGeometry x="600" y="60" width="150" height="50" as="geometry"/>
    </mxCell>

    <!-- EDGES -->

    <!-- User -> Frontend -->
    <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#666666;fontSize=10;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" source="user" target="frontend" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    <mxCell id="e1_label" value="HTTP/HTTPS" style="edgeLabel;html=1;fontSize=9;fontColor=#666666;" vertex="1" connectable="0" parent="e1">
      <mxGeometry x="-0.2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry>
    </mxCell>

    <!-- Frontend -> /api/generate -->
    <mxCell id="e2" value="POST" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#6c8ebf;fontSize=9;exitX=1;exitY=0.3;entryX=0;entryY=0.5;" edge="1" source="frontend" target="api_generate" parent="sveltekit">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- Frontend -> /api/check -->
    <mxCell id="e3" value="POST (poll 5s)" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#6c8ebf;fontSize=9;exitX=1;exitY=0.7;entryX=0;entryY=0.5;" edge="1" source="frontend" target="api_check" parent="sveltekit">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- Frontend -> /api/images -->
    <mxCell id="e4" value="GET" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#6c8ebf;fontSize=9;exitX=1;exitY=0.5;entryX=0;entryY=0.5;dashed=1;" edge="1" source="frontend" target="api_images" parent="sveltekit">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- /api/generate -> Gemini -->
    <mxCell id="e5" value="Prompt request" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#d79b00;fontSize=9;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" source="api_generate" target="gemini" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- /api/generate -> RunningHub -->
    <mxCell id="e6" value="Submit task" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#d79b00;fontSize=9;exitX=0.5;exitY=1;entryX=0.3;entryY=0;" edge="1" source="api_check" target="runninghub" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- /api/check -> RunningHub (poll) -->
    <mxCell id="e7" value="Poll status / Download image" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;startArrow=classic;strokeColor=#d79b00;fontSize=9;exitX=0.8;exitY=1;entryX=0.7;entryY=0;" edge="1" source="api_check" target="runninghub" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- /api/check -> Volume -->
    <mxCell id="e8" value="Save image" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#82b366;fontSize=9;exitX=1;exitY=1;entryX=0.5;entryY=0;" edge="1" source="api_check" target="volume" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- /api/images -> Volume -->
    <mxCell id="e9" value="Read image" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#82b366;fontSize=9;exitX=0.5;exitY=1;entryX=0.5;entryY=0;dashed=1;" edge="1" source="api_images" target="volume" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- Reverse Proxy -> Docker -->
    <mxCell id="e10" value="Port 3000" style="edgeStyle=orthogonalEdgeStyle;curved=1;endArrow=classic;strokeColor=#666666;fontSize=9;dashed=1;exitX=0;exitY=1;entryX=1;entryY=0;" edge="1" source="proxy" target="docker" parent="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

  </root>
</mxGraphModel>